<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Quản lý sinh viên</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="container mx-auto p-4">

<h2 class="text-2xl font-bold mb-4">Quản lý sinh viên</h2>

<div class="mb-4">
    <label for="lop" class="block text-gray-700 text-sm font-bold mb-2">Chọn lớp:</label>
    <select id="lop" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
    </select>
</div>

<h3 class="text-xl font-bold mb-2">Danh sách sinh viên</h3>
<table id="bangSinhVien" class="table-auto w-full">
    <thead>
    <tr>
        <th class="px-4 py-2">Họ tên</th>
        <th class="px-4 py-2">Mã SV</th>
        <th class="px-4 py-2">Ngày sinh</th>
        <th class="px-4 py-2">Hành động</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<div id="formSinhVienModal" class="hidden fixed z-10 inset-0 overflow-y-auto">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
        <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">Thêm/Sửa Sinh Viên</h3>
            <div>
                <form id="formSinhVien">
                    <div class="mb-4">
                        <label for="hoTen" class="block text-gray-700 text-sm font-bold mb-2">Họ tên:</label>
                        <input type="text" id="hoTen" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    </div>
                    <div class="mb-4">
                        <label for="maSV" class="block text-gray-700 text-sm font-bold mb-2">Mã SV:</label>
                        <input type="text" id="maSV" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    </div>
                    <div class="mb-4">
                        <label for="ngaySinh" class="block text-gray-700 text-sm font-bold mb-2">Ngày sinh:</label>
                        <input type="date" id="ngaySinh" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    </div>
                    <div class="mb-4">
                        <label for="lop" class="block text-gray-700 text-sm font-bold mb-2">Lớp:</label>
                        <input type="text" id="lop" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    </div>
                    <div class="flex items-center justify-between">
                        <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                            Lưu
                        </button>
                        <button type="button" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" onclick="dongForm()">
                            Hủy
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        let data = [];
        let selectedClassIndex = 0;

        // Đọc dữ liệu từ data.json và hiển thị danh sách lớp vào dropdown
        $.getJSON("data.json", function(response) {
            data = response;
            const selectLop = $("#lop");
            data.forEach((lop, index) => {
                selectLop.append(new Option(lop.tenLop, index));
            });
            hienThiDanhSachSinhVien();
        });

        // Xử lý sự kiện khi chọn lớp từ dropdown
        $("#lop").change(function() {
            selectedClassIndex = $(this).val();
            hienThiDanhSachSinhVien();
        });

        function hienThiDanhSachSinhVien() {
            const bangSinhVien = $("#bangSinhVien tbody");
            bangSinhVien.empty();
            const lop = data[selectedClassIndex];
            lop.sinhVien.forEach((sinhVien, index) => {
                const row = `<tr>
                    <td class="border px-4 py-2">${sinhVien.hoTen}</td>
                    <td class="border px-4 py-2">${sinhVien.maSV}</td>
                    <td class="border px-4 py-2">${sinhVien.ngaySinh}</td>
                    <td class="border px-4 py-2">
                        <button class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" onclick="suaSinhVien(${index})">Sửa</button>
                        <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" onclick="xoaSinhVien(${index})">Xóa</button>
                    </td>
                </tr>`;
                bangSinhVien.append(row);
            });
        }

        function suaSinhVien(index) {
            const sinhVien = data[selectedClassIndex].sinhVien[index];
            $("#hoTen").val(sinhVien.hoTen);
            $("#maSV").val(sinhVien.maSV);
            $("#ngaySinh").val(sinhVien.ngaySinh);
            $("#lop").val(data[selectedClassIndex].tenLop);
            $("#formSinhVienModal").removeClass("hidden");
            $("#formSinhVien").off("submit").on("submit", function(event) {
                event.preventDefault();
                data[selectedClassIndex].sinhVien[index] = {
                    hoTen: $("#hoTen").val(),
                    maSV: $("#maSV").val(),
                    ngaySinh: $("#ngaySinh").val(),
                    lop: $("#lop").val()
                };
                dongForm();
                capNhatData();
            });
        }

        function xoaSinhVien(index) {
            if (confirm("Bạn có chắc chắn muốn xóa sinh viên này không?")) {
                data[selectedClassIndex].sinhVien.splice(index, 1);
                capNhatData();
            }
        }

        function capNhatData() {
            $.ajax({
                url: "save.php",
                method:"POST",
                data: { data: JSON.stringify(data) },
                success: function() {
                    hienThiDanhSachSinhVien();
                }
            });
        }

        function dongForm() {
            $("#formSinhVienModal").addClass("hidden");
        }

        window.dongForm = dongForm;
        window.suaSinhVien = suaSinhVien;
        window.xoaSinhVien = xoaSinhVien;
    });
</script>

</body>
</html>
